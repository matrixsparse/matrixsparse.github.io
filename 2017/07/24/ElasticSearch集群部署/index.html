<!DOCTYPE html>
<html lang="zh-CN">

  
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  <meta name="author" content="sparsematrix@163.com">
  
  

  <title>ElasticSearché›†ç¾¤éƒ¨ç½² | æ¯å¤©ï¼Œé‡åˆ°æ›´å¥½çš„ä½ </title>

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
    <meta name="keywords" content="elasticsearch,elasticsearch,">
  

  <script>
    console.log('\n%c Hexo-theme-bmw v4.0 ' + '%c ğŸ‰ https://github.com/dongyuanxin/theme-bmw ğŸ‰\n' + '\n%c View demo online ' + '%c ğŸ” https://godbmw.com/ ğŸ”  \n' , 'color: #fadfa3; background: #030307; padding:3px 0;', '', 'color: #fadfa3; background: #030307; padding:3px 0;', '');
  </script>

  

  

  
    <link rel="icon" href="/images/favicon.ico">
    <link rel="apple-touch-icon" href="/images/favicon.ico">
  

  <link href="https://cdn.bootcss.com/fancybox/3.5.2/jquery.fancybox.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/base.css">
<link rel="stylesheet" href="/icon/iconfont.css">
<link rel="stylesheet" href="/css/github-markdown.css">
<link rel="stylesheet" href="/css/highlight.css">

  <script src="/js/util.js"></script>
<script src="/js/valine.min.js"></script>

  

  
    <link href="https://cdn.bootcss.com/aplayer/1.10.1/APlayer.min.css" rel="stylesheet">
    <script src="https://cdn.bootcss.com/aplayer/1.10.1/APlayer.min.js" async></script>
  

  
    <link href="https://cdn.bootcss.com/social-share.js/1.0.16/css/share.min.css" rel="stylesheet">
  

  <script src="//cdn.bootcss.com/jquery/3.3.1/jquery.min.js" async></script>

  
    <script src="//cdn.jsdelivr.net/npm/leancloud-storage@3.11.0/dist/av-min.js"></script>
  

</head>


  <body>

    

    <div id="app">

      <div class="header-wrap">
  <header>
    <div class="site-brand">
      <div class="site-title">
        <!-- <a href="/">MatrixSparse</a> -->
        <img alt="logo" class="antd-pro-layouts-user-layout-logo" src="/images/favicon.png" style="width: 200px;height: 40px;margin: 10px 0 0 5px;">
      </div>
    </div>
    <nav class="site-navigation">
      <ul class="nav-menu">
      
        <li class="nav-item" data-path="/">
          
            <a href="/" target="_self">
              ä¸»é¡µ
            </a>
          
        </li>
      
        <li class="nav-item" data-path="/archives/">
          
            <a href="/archives/" target="_self">
              å½’æ¡£
            </a>
          
        </li>
      
        <li class="nav-item" data-path="/categories/">
          
            <a href="/categories/" target="_self">
              åˆ†ç±»
            </a>
          
        </li>
      
        <li class="nav-item" data-path="/tags/">
          
            <a href="/tags/" target="_self">
              æ ‡ç­¾
            </a>
          
        </li>
      
        <li class="nav-item" data-path="">
          
            <a href="javascript:void(0);" v-else="">åšå®¢åœ°å€</a>
            <ul class="nav-menu--dropdown">
              
                <li>
                  <a href="https://blog.csdn.net/qq_25371579" target="_blank">
                    CSDN
                  </a>
                </li>
              
                <li>
                  <a href="https://github.com/matrixsparse" target="_blank">
                    Github
                  </a>
                </li>
              
                <li>
                  <a href="https://matrixsparse.github.io/" target="_blank">
                    Github Page
                  </a>
                </li>
              
            </ul>
          
        </li>
      
      </ul>
    </nav>
    <i class="iconfont icon-menu"></i>
  </header>
</div>

<script>
  let links = document.querySelectorAll('.nav-item');
  for(let link of links){
    let childrenLink = link.querySelector('ul');
    link.addEventListener('mouseenter', () => {
      if(childrenLink) {
        childrenLink.className = "nav-menu--dropdown active";
      }
    })
    link.addEventListener('mouseleave', () => {
      if(childrenLink) {
        childrenLink.className = "nav-menu--dropdown";
      }
    })
  }
  let rootRealPath = getRealPath(window.location.pathname, true);
  for(let link of links) {
    let linkPath = link.getAttribute("data-path");
    if(linkPath && getRealPath(linkPath, true) === rootRealPath) {
      link.className = "nav-item hover";
    }
  }

  let iconMenu = document.querySelector("i.iconfont.icon-menu"),
    iconMenuClicked = false;
  let navDOM = document.querySelector("nav.site-navigation");
  iconMenu.addEventListener("click", () => {
    iconMenuClicked
      ? navDOM.className = "site-navigation active"
      : navDOM.className = "site-navigation";
    iconMenuClicked = !iconMenuClicked;
  })
</script>


      








<div class="container post-index">

  

<div class="post">
  <h1 class="article-title">
    <span>ElasticSearché›†ç¾¤éƒ¨ç½²</span>
  </h1>
  <div class="article-top-meta">
    <span>
      å‘å¸ƒ : 
      2017-07-24
    </span>
    
      <span>
        åˆ†ç±» : 
          <a href="/categories/elasticsearch/">
            elasticsearch
          </a>
      </span>
    
    
      <span>
        æµè§ˆ : <span class="article-timer" data-identity="ElasticSearché›†ç¾¤éƒ¨ç½²"></span>
      </span>
    
  </div>

  

  <div class="article-content">
    <div class="markdown-body">
      <h2 id="CentOS-7ä¸­å¯ç”¨å¹¶ä½¿ç”¨â€ifconfigâ€å‘½ä»¤"><a href="#CentOS-7ä¸­å¯ç”¨å¹¶ä½¿ç”¨â€ifconfigâ€å‘½ä»¤" class="headerlink" title="CentOS 7ä¸­å¯ç”¨å¹¶ä½¿ç”¨â€ifconfigâ€å‘½ä»¤"></a>CentOS 7ä¸­å¯ç”¨å¹¶ä½¿ç”¨â€ifconfigâ€å‘½ä»¤</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install net-tools -y</span><br></pre></td></tr></table></figure>
<h2 id="ESé›†ç¾¤"><a href="#ESé›†ç¾¤" class="headerlink" title="ESé›†ç¾¤"></a>ESé›†ç¾¤</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">192.168.31.180 elasticsearch01</span><br><span class="line">192.168.31.181 elasticsearch02</span><br><span class="line">192.168.31.182 elasticsearch03</span><br></pre></td></tr></table></figure>
<h2 id="è§£å‹ESå‹ç¼©æ–‡ä»¶-amp-é‡å‘½å"><a href="#è§£å‹ESå‹ç¼©æ–‡ä»¶-amp-é‡å‘½å" class="headerlink" title="è§£å‹ESå‹ç¼©æ–‡ä»¶&amp;é‡å‘½å"></a>è§£å‹ESå‹ç¼©æ–‡ä»¶&amp;é‡å‘½å</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@elasticsearch01 ~]<span class="comment"># tar -zxvf elasticsearch-5.5.0.tar.gz -C /usr/local</span></span><br><span class="line">[root@elasticsearch01 ~]<span class="comment"># cd /usr/local/</span></span><br><span class="line">[root@elasticsearch01 <span class="built_in">local</span>]<span class="comment"># mv elasticsearch-5.5.0 elasticsearch</span></span><br></pre></td></tr></table></figure>
<h2 id="zen-discoveryé›†ç¾¤å‘ç°æœºåˆ¶"><a href="#zen-discoveryé›†ç¾¤å‘ç°æœºåˆ¶" class="headerlink" title="zen discoveryé›†ç¾¤å‘ç°æœºåˆ¶"></a>zen discoveryé›†ç¾¤å‘ç°æœºåˆ¶</h2><h3 id="å¦‚ä½•è®©å¤šå°æœºå™¨ä¸Šçš„å¤šä¸ªesè¿›ç¨‹ï¼Œäº’ç›¸å‘ç°å¯¹æ–¹ï¼Œç„¶åç»„æˆç”Ÿäº§ç¯å¢ƒé›†ç¾¤"><a href="#å¦‚ä½•è®©å¤šå°æœºå™¨ä¸Šçš„å¤šä¸ªesè¿›ç¨‹ï¼Œäº’ç›¸å‘ç°å¯¹æ–¹ï¼Œç„¶åç»„æˆç”Ÿäº§ç¯å¢ƒé›†ç¾¤" class="headerlink" title="å¦‚ä½•è®©å¤šå°æœºå™¨ä¸Šçš„å¤šä¸ªesè¿›ç¨‹ï¼Œäº’ç›¸å‘ç°å¯¹æ–¹ï¼Œç„¶åç»„æˆç”Ÿäº§ç¯å¢ƒé›†ç¾¤"></a>å¦‚ä½•è®©å¤šå°æœºå™¨ä¸Šçš„å¤šä¸ªesè¿›ç¨‹ï¼Œäº’ç›¸å‘ç°å¯¹æ–¹ï¼Œç„¶åç»„æˆç”Ÿäº§ç¯å¢ƒé›†ç¾¤</h3><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œesè¿›ç¨‹ä¼šç»‘å®šåœ¨è‡ªå·±çš„å›ç¯åœ°å€ä¸Šï¼Œä¹Ÿå°±æ˜¯127.0.0.1ï¼Œç„¶åæ‰«ææœ¬æœºä¸Šçš„<code>9300~9305</code>ç«¯å£å·ï¼Œå°è¯•è·Ÿé‚£äº›ç«¯å£ä¸Šå¯åŠ¨çš„å…¶ä»–esè¿›ç¨‹è¿›è¡Œé€šä¿¡ï¼Œç„¶åç»„æˆä¸€ä¸ªé›†ç¾¤ã€‚è¿™å¯¹äºåœ¨æœ¬æœºä¸Šæ­å»ºesé›†ç¾¤çš„å¼€å‘ç¯å¢ƒæ˜¯å¾ˆæ–¹ä¾¿çš„ã€‚ä½†æ˜¯å¯¹äº<code>ç”Ÿäº§ç¯å¢ƒ</code>ä¸‹çš„é›†ç¾¤æ˜¯ä¸è¡Œçš„ï¼Œéœ€è¦å°†æ¯å°<code>esè¿›ç¨‹</code>ç»‘å®šåœ¨ä¸€ä¸ª<code>éå›ç¯çš„ipåœ°å€</code>ä¸Šï¼Œæ‰èƒ½è·Ÿå…¶ä»–èŠ‚ç‚¹è¿›è¡Œé€šä¿¡ï¼ŒåŒæ—¶éœ€è¦ä½¿ç”¨é›†ç¾¤å‘ç°æœºåˆ¶æ¥è·Ÿå…¶ä»–èŠ‚ç‚¹ä¸Šçš„es nodeè¿›è¡Œé€šä¿¡</p>
<p>åœ¨ç”Ÿäº§ç¯å¢ƒä¸­çš„å¤šå°æœºå™¨ä¸Šéƒ¨ç½²esé›†ç¾¤ï¼Œæ¶‰åŠåˆ°<code>esçš„discoveryæœºåˆ¶</code>ï¼Œä¹Ÿå°±æ˜¯é›†ç¾¤ä¸­å„ä¸ªèŠ‚ç‚¹äº’ç›¸å‘ç°åç»„æˆä¸€ä¸ªé›†ç¾¤çš„æœºåˆ¶ï¼ŒåŒæ—¶<code>discoveryæœºåˆ¶</code>ä¹Ÿ<code>è´Ÿè´£esé›†ç¾¤çš„masteré€‰ä¸¾</code></p>
<h3 id="master-nodeå’Œdata-nodeä¸¤ç§è§’è‰²"><a href="#master-nodeå’Œdata-nodeä¸¤ç§è§’è‰²" class="headerlink" title="master nodeå’Œdata nodeä¸¤ç§è§’è‰²"></a>master nodeå’Œdata nodeä¸¤ç§è§’è‰²</h3><p>esæ˜¯ä¸€ç§peer to peerï¼Œ<code>p2pç‚¹å¯¹ç‚¹çš„åˆ†å¸ƒå¼ç³»ç»Ÿæ¶æ„</code>(é›†ç¾¤ä¸­çš„æ¯ä¸ªnodeç›´æ¥è·Ÿå…¶ä»–èŠ‚ç‚¹è¿›è¡Œé€šä¿¡ï¼Œå‡ ä¹æ‰€æœ‰APIæ“ä½œï¼Œå¦‚indexï¼Œdeleteï¼Œsearchï¼Œéƒ½ä¸æ˜¯clientè·Ÿmasteré€šä¿¡ï¼Œè€Œæ˜¯clientè·Ÿä»»ä½•ä¸€ä¸ªnodeè¿›è¡Œé€šä¿¡ï¼Œnodeå†å°†è¯·æ±‚è½¬å‘ç»™å¯¹åº”çš„nodeè¿›è¡Œæ‰§è¡Œ)ï¼Œä¸æ˜¯hadoopç”Ÿæ€é‡‡ç”¨çš„master-slaveä¸»ä»æ¶æ„çš„åˆ†å¸ƒå¼ç³»ç»Ÿæ¶æ„</p>
<p>ä¸¤ä¸ªè§’è‰²ï¼Œmaster nodeï¼Œdata nodeã€‚æ­£å¸¸æƒ…å†µä¸‹ï¼Œå°±åªæœ‰ä¸€ä¸ªmaster node</p>
<p>master node<code>è´Ÿè´£ç»´æŠ¤æ•´ä¸ªé›†ç¾¤çš„çŠ¶æ€ä¿¡æ¯</code>[é›†ç¾¤å…ƒæ•°æ®ä¿¡æ¯]ï¼ŒåŒæ—¶åœ¨nodeåŠ å…¥é›†ç¾¤æˆ–è€…ä»é›†ç¾¤ä¸­ä¸‹é™è¦…æŒ‰æ—¶ï¼Œé‡æ–°åˆ†é…shardï¼Œæˆ–è€…æ˜¯åˆ›å»ºæˆ–åˆ é™¤äº†ä¸€ä¸ªç´¢å¼•ã€‚åŒ…æ‹¬æ¯æ¬¡cluster stateå¦‚æœæœ‰æ”¹å˜çš„åŒ–ï¼Œé‚£ä¹ˆmasteréƒ½ä¼šè´Ÿè´£å°†é›†ç¾¤çŠ¶æ€åŒæ­¥ç»™æ‰€æœ‰çš„node</p>
<p>master node<code>è´Ÿè´£æ¥æ”¶æ‰€æœ‰çš„cluster stateç›¸å…³çš„å˜åŒ–ä¿¡æ¯</code>ï¼Œå°†è¿™ä¸ªæ”¹å˜åçš„æœ€æ–°çš„cluster stateæ¨åŠ¨ç»™é›†ç¾¤ä¸­æ‰€æœ‰çš„data nodeï¼Œé›†ç¾¤ä¸­æ‰€æœ‰çš„nodeéƒ½æœ‰ä¸€ä»½å®Œæ•´çš„cluster state,master nodeè´Ÿè´£ç»´æŠ¤</p>
<p>data node<code>è´Ÿè´£æ•°æ®çš„å­˜å‚¨å’Œè¯»å†™çš„</code>ï¼Œå†™å…¥ç´¢å¼•ï¼Œæœç´¢æ•°æ®</p>
<h3 id="è®¾ç½®cluster-name"><a href="#è®¾ç½®cluster-name" class="headerlink" title="è®¾ç½®cluster.name"></a>è®¾ç½®cluster.name</h3><blockquote>
<p>å¦‚æœè¦è®©å¤šä¸ªnodeç»„æˆä¸€ä¸ªesé›†ç¾¤ï¼Œ<code>ç¬¬ä¸€ä¸ªè¦è®¾ç½®çš„å‚æ•°</code>ï¼Œæ˜¯<code>cluster.name</code>ï¼Œå¤šä¸ªnodeçš„cluster.nameä¸€æ ·ï¼Œæ‰æ»¡è¶³ç»„æˆä¸€ä¸ªé›†ç¾¤çš„åŸºæœ¬æ¡ä»¶</p>
</blockquote>
<p>è¿™ä¸ªcluster.nameçš„é»˜è®¤å€¼æ˜¯elasticsearchï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œä¸€å®šè¦ä¿®æ”¹è¿™ä¸ªå€¼ï¼Œå¦åˆ™å¯èƒ½ä¼šå¯¼è‡´æœªçŸ¥çš„nodeæ— ç«¯åŠ å…¥é›†ç¾¤ï¼Œé€ æˆé›†ç¾¤è¿è¡Œå¼‚å¸¸ã€‚</p>
<p>è€Œesä¸­é»˜è®¤çš„discoveryæœºåˆ¶ï¼Œå°±æ˜¯zen discoveryæœºåˆ¶</p>
<p>zen discoveryæœºåˆ¶æä¾›äº†unicast discoveryé›†ç¾¤å‘ç°æœºåˆ¶ï¼Œé›†ç¾¤å‘ç°æ—¶çš„èŠ‚ç‚¹é—´é€šä¿¡æ˜¯ä¾èµ–çš„transport moduleï¼Œä¹Ÿå°±æ˜¯esåº•å±‚çš„ç½‘ç»œé€šä¿¡æ¨¡å—å’Œåè®®ã€‚</p>
<p>esé»˜è®¤é…ç½®ä¸ºä½¿ç”¨unicasté›†ç¾¤å‘ç°æœºåˆ¶ï¼Œä»¥è®©ç»è¿‡ç‰¹æ®Šé…ç½®çš„èŠ‚ç‚¹å¯ä»¥ç»„æˆä¸€ä¸ªé›†ç¾¤ï¼Œè€Œä¸æ˜¯éšä¾¿å“ªä¸ªèŠ‚ç‚¹éƒ½å¯ä»¥ç»„æˆä¸€ä¸ªé›†ç¾¤ã€‚ä½†æ˜¯é»˜è®¤é…ç½®ä¸‹ï¼Œunicastæ˜¯æœ¬æœºï¼Œä¹Ÿå°±æ˜¯localhostï¼Œå› æ­¤åªèƒ½åœ¨ä¸€å°æœºå™¨ä¸Šå¯åŠ¨å¤šä¸ªnodeæ¥ç»„æˆä¸€ä¸ªé›†ç¾¤ã€‚è™½ç„¶esè¿˜æ˜¯ä¼šæä¾›multicast pluginä½œä¸ºä¸€ä¸ªå‘ç°æœºåˆ¶ï¼Œä½†æ˜¯å·²ç»ä¸å»ºè®®åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨äº†ã€‚è™½ç„¶æˆ‘ä»¬å¯èƒ½æƒ³è¦multicastçš„ç®€å•æ€§ï¼Œå°±æ˜¯æ‰€æœ‰çš„nodeå¯ä»¥å†æ¥æ”¶åˆ°ä¸€æ¡multicast pingä¹‹åå°±ç«‹å³è‡ªåŠ¨åŠ å…¥é›†ç¾¤ã€‚ä½†æ˜¯multicastæœºåˆ¶æœ‰å¾ˆå¤šçš„é—®é¢˜ï¼Œè€Œä¸”å¾ˆè„†å¼±ï¼Œæ¯”å¦‚ç½‘ç»œæœ‰è½»å¾®çš„è°ƒæ•´ï¼Œå°±å¯èƒ½å¯¼è‡´èŠ‚ç‚¹æ— æ³•å‘ç°å¯¹æ–¹ã€‚å› æ­¤ç°åœ¨å»ºè®®åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ç”¨unicastæœºåˆ¶ï¼Œæä¾›ä¸€ä¸ªesç§å­nodeä½œä¸ºä¸­è½¬è·¯ç”±èŠ‚ç‚¹å°±å¯ä»¥</p>
<h3 id="master-nodeã€data-nodeã€network-host"><a href="#master-nodeã€data-nodeã€network-host" class="headerlink" title="master nodeã€data nodeã€network.host"></a>master nodeã€data nodeã€network.host</h3><p>ç»™é›†ç¾¤è§„åˆ’å‡ºä¸“é—¨çš„master eligible nodeå’Œdata node</p>
<p>master nodeï¼Œmaster eligible nodeï¼Œdata node</p>
<p>é…ç½®å¤šä¸ªnodeå˜æˆmaster eligible nodeï¼Œä»è¿™äº›master eligible nodeé€‰ä¸¾ä¸€ä¸ªnodeå‡ºæ¥ä½œä¸ºmaster nodeï¼Œå…¶ä»–master eligible nodeåªæ˜¯æ¥ä¸‹æ¥æœ‰é‚£ä¸ªmaster nodeæ•…éšœçš„æ—¶å€™ï¼Œæ¥æ›¿ä»–çš„èµ„æ ¼ï¼Œä½†æ˜¯è¿˜æ˜¯ä½œä¸ºdata nodeå»ä½¿ç”¨çš„</p>
<p>ä¸€èˆ¬å»ºè®®master eligible nodeç»™3ä¸ªå³å¯ï¼šnode.master: trueï¼Œnode.data: false<br>å‰©ä¸‹çš„nodeéƒ½è®¾ç½®ä¸ºdata nodeï¼šnode.master: falseï¼Œnode.data: true</p>
<p>ä½†æ˜¯å¦‚æœä¸€ä¸ªå°é›†ç¾¤ï¼Œå°±10ä¸ªä»¥å†…çš„èŠ‚ç‚¹ï¼Œé‚£å°±æ‰€æœ‰èŠ‚ç‚¹éƒ½å¯ä»¥ä½œä¸ºmaster eligible nodeä»¥åŠdata nodeå³å¯ï¼Œè¶…è¿‡10ä¸ªnodeçš„é›†ç¾¤å†å•ç‹¬æ‹†åˆ†masterå’Œdata nodeå§</p>
<p>å¦‚æœä½ çš„èŠ‚ç‚¹æ•°é‡å°äº10ä¸ªï¼Œå°é›†ç¾¤ï¼Œé‚£æ‰€æœ‰çš„nodeï¼Œå°±ä¸è¦åšé¢å¤–çš„é…ç½®äº†ï¼Œmaster eligible nodeï¼ŒåŒæ—¶ä¹Ÿæ˜¯data node</p>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œesä¼šå°†è‡ªå·±ç»‘å®šåˆ°127.0.0.1ä¸Šï¼Œå¯¹äºè¿è¡Œä¸€ä¸ªå•èŠ‚ç‚¹çš„å¼€å‘æ¨¡å¼ä¸‹çš„esæ˜¯okçš„ã€‚ä½†æ˜¯ä¸ºäº†è®©èŠ‚ç‚¹é—´å¯ä»¥äº’ç›¸é€šä¿¡ä»¥ç»„æˆä¸€ä¸ªé›†ç¾¤ï¼Œéœ€è¦è®©èŠ‚ç‚¹ç»‘å®šåˆ°ä¸€ä¸ªipåœ°å€ä¸Šï¼Œéå›ç¯çš„åœ°å€ï¼Œä¸€èˆ¬ä¼šé…ç½®ï¼š<br>network.host: 192.168.1.10</p>
<p>ä¸€æ—¦æˆ‘ä»¬é…ç½®äº†network.hostï¼Œé‚£ä¹ˆeså°±ä¼šè®¤ä¸ºæˆ‘ä»¬ä»å¼€å‘æ¨¡å¼è¿ç§»åˆ°ç”Ÿäº§æ¨¡å¼ï¼ŒåŒæ—¶ä¼šå¯ç”¨ä¸€ç³»åˆ—çš„bootstrap check</p>
<h3 id="ping"><a href="#ping" class="headerlink" title="ping"></a>ping</h3><p>pingæ˜¯ä¸€ä¸ªnodeç”¨discoveryæœºåˆ¶æ¥å‘ç°å…¶ä»–nodeçš„ä¸€ä¸ªè¿‡ç¨‹</p>
<h3 id="unicast"><a href="#unicast" class="headerlink" title="unicast"></a>unicast</h3><p>unicast discoveryé›†ç¾¤å‘ç°æœºåˆ¶æ˜¯è¦æ±‚<code>é…ç½®ä¸€ä¸ªä¸»æœºåˆ—è¡¨</code>ï¼Œç”¨æ¥ä½œä¸ºgossipï¼ˆæµè¨€å¼ï¼‰é€šä¿¡åè®®çš„è·¯ç”±å™¨ã€‚è¿™äº›æœºå™¨å¦‚æœé€šè¿‡hostnameæ¥æŒ‡å®šï¼Œé‚£ä¹ˆåœ¨pingçš„æ—¶å€™ä¼šè¢«è§£æä¸ºipåœ°å€ã€‚unicast discoveryæœºåˆ¶æœ€é‡è¦çš„ä¸¤ä¸ªé…ç½®å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p>hostsï¼šç”¨é€—å·åˆ†å‰²çš„ä¸»æœºåˆ—è¡¨<br>hosts.resolve_timeoutï¼šhostnameè¢«DNSè§£æä¸ºipåœ°å€çš„timeoutç­‰å¾…æ—¶é•¿</p>
<p>ç®€å•æ¥è¯´ï¼Œå¦‚æœè¦è®©å¤šä¸ªèŠ‚ç‚¹å‘ç°å¯¹æ–¹å¹¶ä¸”ç»„æˆä¸€ä¸ªé›†ç¾¤ï¼Œé‚£ä¹ˆå°±å¾—æœ‰ä¸€ä¸ªä¸­é—´çš„å…¬å…±èŠ‚ç‚¹ï¼Œç„¶åä¸åŒçš„èŠ‚ç‚¹å°±å‘é€è¯·æ±‚åˆ°è¿™äº›å…¬å…±èŠ‚ç‚¹ï¼Œæ¥ç€é€šè¿‡è¿™äº›å…¬å…±èŠ‚ç‚¹äº¤æ¢å„è‡ªçš„ä¿¡æ¯ï¼Œè¿›è€Œè®©æ‰€æœ‰çš„nodeæ„ŸçŸ¥åˆ°å…¶ä»–çš„nodeå­˜åœ¨ï¼Œå¹¶ä¸”è¿›è¡Œé€šä¿¡ï¼Œæœ€åç»„æˆä¸€ä¸ªé›†ç¾¤ã€‚è¿™å°±æ˜¯åŸºäºgossipæµè¨€å¼é€šä¿¡åè®®çš„unicasté›†ç¾¤å‘ç°æœºåˆ¶ã€‚</p>
<p>å½“ä¸€ä¸ªnodeä¸unicast node listä¸­çš„ä¸€ä¸ªæˆå‘˜é€šä¿¡ä¹‹åï¼Œå°±ä¼šæ¥æ”¶åˆ°ä¸€ä»½å®Œæ•´çš„é›†ç¾¤çŠ¶æ€ï¼Œè¿™é‡Œä¼šåˆ—å‡ºé›†ç¾¤ä¸­æ‰€æœ‰çš„nodeã€‚æ¥ç€é‚£ä¸ªnodeå†é€šè¿‡cluster stateè·Ÿmasteré€šä¿¡ï¼Œå¹¶ä¸”åŠ å…¥é›†ç¾¤ä¸­ã€‚è¿™å°±æ„å‘³ç€ï¼Œæˆ‘ä»¬çš„unicast list nodeæ˜¯ä¸éœ€è¦åˆ—å‡ºé›†ç¾¤ä¸­çš„æ‰€æœ‰èŠ‚ç‚¹çš„ã€‚åªè¦æä¾›å°‘æ•°å‡ ä¸ªnodeï¼Œæ¯”å¦‚3ä¸ªï¼Œè®©æ–°çš„nodeå¯ä»¥è¿æ¥ä¸Šå³å¯ã€‚å¦‚æœæˆ‘ä»¬ç»™é›†ç¾¤ä¸­åˆ†é…äº†å‡ ä¸ªèŠ‚ç‚¹ä½œä¸ºä¸“é—¨çš„masterèŠ‚ç‚¹ï¼Œé‚£ä¹ˆåªè¦åˆ—å‡ºæˆ‘ä»¬é‚£ä¸‰ä¸ªä¸“é—¨çš„masterèŠ‚ç‚¹å³å¯ã€‚ç”¨å¦‚ä¸‹çš„é…ç½®å³å¯ï¼šdiscovery.zen.ping.unicast.hosts: [â€œhost1â€, â€œhost2:portâ€]ã€‚</p>
<p>cluster.name<br>node.name<br>network.host<br>discovery.zen.ping.unicast.hosts</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ï¼ˆ1ï¼‰é€šè¿‡network.hostç»‘å®šåˆ°äº†éå›ç¯çš„ipåœ°å€ï¼Œä»è€Œå¯ä»¥è·Ÿå…¶ä»–èŠ‚ç‚¹é€šä¿¡</span><br><span class="line">ï¼ˆ2ï¼‰é€šè¿‡discovery.zen.ping.unicast.hostsé…ç½®äº†ä¸€æ‰¹unicastä¸­é—´è·¯ç”±çš„node</span><br><span class="line">ï¼ˆ3ï¼‰æ‰€æœ‰nodeéƒ½å¯ä»¥å‘é€pingæ¶ˆæ¯åˆ°è·¯ç”±nodeï¼Œå†ä»è·¯ç”±nodeè·å–cluster stateå›æ¥</span><br><span class="line">ï¼ˆ4ï¼‰æ¥ç€æ‰€æœ‰nodeä¼šé€‰ä¸¾å‡ºä¸€ä¸ªmaster</span><br><span class="line">ï¼ˆ5ï¼‰æ‰€æœ‰nodeéƒ½ä¼šè·Ÿmasterè¿›è¡Œé€šä¿¡ï¼Œç„¶ååŠ å…¥masterçš„é›†ç¾¤</span><br><span class="line">ï¼ˆ6ï¼‰è¦æ±‚cluster.nameå¿…é¡»ä¸€æ ·ï¼Œæ‰èƒ½ç»„æˆä¸€ä¸ªé›†ç¾¤</span><br><span class="line">ï¼ˆ7ï¼‰node.nameå°±æ ‡è¯†å‡ºäº†æ¯ä¸ªnodeæˆ‘ä»¬è‡ªå·±è®¾ç½®çš„ä¸€ä¸ªåç§°</span><br></pre></td></tr></table></figure>
<h3 id="masteré€‰ä¸¾"><a href="#masteré€‰ä¸¾" class="headerlink" title="masteré€‰ä¸¾"></a>masteré€‰ä¸¾</h3><p>åœ¨pingå‘ç°è¿‡ç¨‹ä¸­ï¼Œä¸ºé›†ç¾¤é€‰ä¸¾å‡ºä¸€ä¸ªmasterä¹Ÿæ˜¯å¾ˆé‡è¦çš„ï¼Œesé›†ç¾¤ä¼šè‡ªåŠ¨å®Œæˆè¿™ä¸ªæ“ä½œã€‚è®¾ç½®<code>discovery.zen.ping_timeout</code>å‚æ•°ï¼ˆé»˜è®¤æ˜¯3sï¼‰ï¼Œå¦‚æœç½‘ç»œæ…¢æˆ–è€…æ‹¥å¡ï¼Œå¯¼è‡´masteré€‰ä¸¾è¶…æ—¶ï¼Œå¯ä»¥å¢åŠ è¿™ä¸ªå‚æ•°ï¼Œç¡®ä¿é›†ç¾¤å¯åŠ¨çš„ç¨³å®šæ€§ã€‚</p>
<p>åœ¨å®Œæˆä¸€ä¸ªé›†ç¾¤çš„masteré€‰ä¸¾ä¹‹åï¼Œæ¯æ¬¡ä¸€ä¸ªæ–°çš„nodeåŠ å…¥é›†ç¾¤ï¼Œéƒ½ä¼šå‘é€ä¸€ä¸ªjoin requeståˆ°master nodeï¼Œå¯ä»¥<code>è®¾ç½®discovery.zen.join_timeout</code>ï¼Œä¿è¯nodeç¨³å®šåŠ å…¥é›†ç¾¤ï¼Œå¢åŠ joinçš„timeoutç­‰å¾…æ—¶é•¿ï¼Œå¦‚æœä¸€æ¬¡joinä¸ä¸Šï¼Œé»˜è®¤ä¼š<code>é‡è¯•20æ¬¡</code></p>
<p>å¦‚æœmaster nodeè¢«åœæ­¢äº†ï¼Œæˆ–è€…è‡ªå·±å®•æœºäº†ï¼Œé‚£ä¹ˆé›†ç¾¤ä¸­çš„nodeä¼šå†æ¬¡è¿›è¡Œä¸€æ¬¡pingè¿‡ç¨‹ï¼Œå¹¶ä¸”é€‰ä¸¾å‡ºä¸€ä¸ªæ–°çš„masterã€‚discovery.zen.master_election.ignore_non_master_pingsè®¾ç½®ä¸ºtrueï¼Œä¼šå¼ºåˆ¶åŒºåˆ†masterå€™é€‰èŠ‚ç‚¹ï¼Œå¦‚æœnodeçš„node.masterè®¾ç½®ä¸ºäº†falseï¼Œè¿˜æ¥å‘é€pingè¯·æ±‚å‚ä¸masteré€‰ä¸¾ï¼Œé‚£ä¹ˆè¿™äº›nodeä¼šè¢«å¿½ç•¥æ‰ï¼Œå› ä¸ºä»–ä»¬æ²¡æœ‰èµ„æ ¼å‚ä¸ã€‚</p>
<p>discovery.zen.minimum_master_nodeså‚æ•°ç”¨äºè®¾ç½®å¯¹äºä¸€ä¸ªæ–°é€‰ä¸¾çš„masterï¼Œè¦æ±‚å¿…é¡»æœ‰å¤šå°‘ä¸ªmasterå€™é€‰nodeå»è¿æ¥é‚£ä¸ªæ–°é€‰ä¸¾çš„masterã€‚è€Œä¸”è¿˜ç”¨äºè®¾ç½®ä¸€ä¸ªé›†ç¾¤ä¸­å¿…é¡»æ‹¥æœ‰çš„masterå€™é€‰nodeã€‚å¦‚æœè¿™äº›è¦æ±‚æ²¡æœ‰è¢«æ»¡è¶³ï¼Œé‚£ä¹ˆmaster nodeå°±ä¼šè¢«åœæ­¢ï¼Œç„¶åä¼šé‡æ–°é€‰ä¸¾ä¸€ä¸ªæ–°çš„masterã€‚è¿™ä¸ªå‚æ•°å¿…é¡»è®¾ç½®ä¸ºæˆ‘ä»¬çš„masterå€™é€‰nodeçš„quorumæ•°é‡ã€‚ä¸€èˆ¬é¿å…è¯´åªæœ‰ä¸¤ä¸ªmasterå€™é€‰nodeï¼Œå› ä¸º2çš„quorumè¿˜æ˜¯2ã€‚å¦‚æœåœ¨é‚£ä¸ªæƒ…å†µä¸‹ï¼Œä»»ä½•ä¸€ä¸ªmasterå€™é€‰èŠ‚ç‚¹å®•æœºäº†ï¼Œé›†ç¾¤å°±æ— æ³•æ­£å¸¸è¿ä½œäº†ã€‚</p>
<h3 id="é›†ç¾¤æ•…éšœçš„æ¢æŸ¥"><a href="#é›†ç¾¤æ•…éšœçš„æ¢æŸ¥" class="headerlink" title="é›†ç¾¤æ•…éšœçš„æ¢æŸ¥"></a>é›†ç¾¤æ•…éšœçš„æ¢æŸ¥</h3><p>esæœ‰ä¸¤ç§é›†ç¾¤æ•…éšœæ¢æŸ¥æœºåˆ¶</p>
<ul>
<li>ç¬¬ä¸€ç§æ˜¯é€šè¿‡masterè¿›è¡Œçš„ï¼Œmasterä¼špingé›†ç¾¤ä¸­æ‰€æœ‰çš„å…¶ä»–nodeï¼Œç¡®ä¿å®ƒä»¬æ˜¯å¦æ˜¯å­˜æ´»ç€çš„</li>
<li>ç¬¬äºŒç§ï¼Œæ¯ä¸ªnodeéƒ½ä¼šå»ping master nodeæ¥ç¡®ä¿master nodeæ˜¯å­˜æ´»çš„ï¼Œå¦åˆ™å°±ä¼šå‘èµ·ä¸€ä¸ªé€‰ä¸¾è¿‡ç¨‹ã€‚</li>
</ul>
<p>æœ‰ä¸‹é¢ä¸‰ä¸ªå‚æ•°ç”¨æ¥é…ç½®é›†ç¾¤æ•…éšœçš„æ¢æŸ¥è¿‡ç¨‹ï¼š</p>
<ul>
<li>ping_intervalï¼šæ¯éš”å¤šé•¿æ—¶é—´ä¼špingä¸€æ¬¡nodeï¼Œé»˜è®¤æ˜¯1s</li>
<li>ping_timeoutï¼šæ¯æ¬¡pingçš„timeoutç­‰å¾…æ—¶é•¿æ˜¯å¤šé•¿æ—¶é—´ï¼Œé»˜è®¤æ˜¯30s</li>
<li>ping_retriesï¼šä¸€ä¸ªnodeè¢«pingå¤šå°‘æ¬¡éƒ½å¤±è´¥äº†ï¼Œå°±ä¼šè®¤ä¸ºnodeæ•…éšœï¼Œé»˜è®¤æ˜¯3æ¬¡</li>
</ul>
<h3 id="é›†ç¾¤çŠ¶æ€æ›´æ–°"><a href="#é›†ç¾¤çŠ¶æ€æ›´æ–°" class="headerlink" title="é›†ç¾¤çŠ¶æ€æ›´æ–°"></a>é›†ç¾¤çŠ¶æ€æ›´æ–°</h3><p>master nodeæ˜¯é›†ç¾¤ä¸­å”¯ä¸€ä¸€ä¸ªå¯ä»¥å¯¹cluster stateè¿›è¡Œæ›´æ–°çš„nodeã€‚master nodeæ¯æ¬¡ä¼šå¤„ç†ä¸€ä¸ªé›†ç¾¤çŠ¶æ€çš„æ›´æ–°äº‹ä»¶ï¼Œåº”ç”¨è¿™æ¬¡çŠ¶æ€æ›´æ–°ï¼Œç„¶åå°†æ›´æ–°åçš„çŠ¶æ€å‘å¸ƒåˆ°é›†ç¾¤ä¸­æ‰€æœ‰çš„nodeä¸Šå»ã€‚æ¯ä¸ªnodeéƒ½ä¼šæ¥æ”¶publish messageï¼Œackè¿™ä¸ªmessageï¼Œä½†æ˜¯ä¸ä¼šåº”ç”¨è¿™ä¸ªæ›´æ–°ã€‚å¦‚æœmasteræ²¡æœ‰åœ¨discovery.zen.commit_timeoutæŒ‡å®šçš„æ—¶é—´å†…ï¼ˆé»˜è®¤æ˜¯30sï¼‰ï¼Œä»è‡³å°‘discovery.zen.minimum_master_nodesä¸ªèŠ‚ç‚¹è·å–ackå“åº”ï¼Œé‚£ä¹ˆè¿™æ¬¡cluster state changeäº‹ä»¶å°±ä¼šè¢«rejectï¼Œä¸ä¼šåº”ç”¨ã€‚</p>
<p>ä½†æ˜¯ä¸€æ—¦åœ¨æŒ‡å®šæ—¶é—´å†…ï¼ŒæŒ‡å®šæ•°é‡çš„nodeéƒ½è¿”å›äº†ackæ¶ˆæ¯ï¼Œé‚£ä¹ˆcluster stateå°±ä¼šè¢«commitï¼Œç„¶åä¸€ä¸ªmessageä¼šè¢«å‘é€ç»™æ‰€æœ‰çš„nodeã€‚æ‰€æœ‰çš„nodeæ¥æ”¶åˆ°é‚£ä¸ªcommit messageä¹‹åï¼Œæ¥ç€æ‰ä¼šå°†ä¹‹å‰æ¥æ”¶åˆ°çš„é›†ç¾¤çŠ¶æ€åº”ç”¨åˆ°è‡ªå·±æœ¬åœ°çš„çŠ¶æ€å‰¯æœ¬ä¸­å»ã€‚æ¥ç€masterä¼šç­‰å¾…æ‰€æœ‰èŠ‚ç‚¹å†æ¬¡å“åº”æ˜¯å¦æ›´æ–°è‡ªå·±æœ¬åœ°å‰¯æœ¬çŠ¶æ€æˆåŠŸï¼Œåœ¨ä¸€ä¸ªç­‰å¾…è¶…æ—¶æ—¶é•¿å†…ï¼Œå¦‚æœæ¥æ”¶åˆ°äº†å“åº”ï¼Œé‚£ä¹ˆå°±ä¼šç»§ç»­å¤„ç†å†…å­˜queueä¸­ä¿å­˜çš„ä¸‹ä¸€ä¸ªæ›´æ–°çŠ¶æ€ã€‚discovery.zen.publish_timeouté»˜è®¤æ˜¯30sï¼Œè¿™ä¸ªè¶…æ—¶ç­‰å¾…æ—¶é•¿æ˜¯ä»plublish cluster stateå¼€å§‹è®¡ç®—çš„ã€‚</p>
<blockquote>
<p>ä¸å› ä¸ºmasterå®•æœºé˜»å¡é›†ç¾¤æ“ä½œ</p>
</blockquote>
<p>å¦‚æœè¦è®©é›†ç¾¤æ­£å¸¸è¿è½¬ï¼Œé‚£ä¹ˆå¿…é¡»æœ‰ä¸€ä¸ªmasterï¼Œè¿˜æœ‰discovery.zen.minimum_master_nodesæŒ‡å®šæ•°é‡çš„masterå€™é€‰nodeï¼Œéƒ½åœ¨è¿è¡Œ</p>
<p>discovery.zen.no_master_blockå¯ä»¥æ§åˆ¶å½“masterå½“å³æ—¶ï¼Œä»€ä¹ˆæ ·çš„æ“ä½œåº”è¯¥è¢«æ‹’ç»ã€‚æœ‰ä¸‹é¢ä¸¤ä¸ªé€‰é¡¹ï¼š<br>allï¼šä¸€æ—¦masterå½“å³ï¼Œé‚£ä¹ˆæ‰€æœ‰çš„æ“ä½œéƒ½ä¼šè¢«æ‹’ç»<br>writeï¼šè¿™æ˜¯é»˜è®¤çš„é€‰é¡¹ï¼Œæ‰€æœ‰çš„å†™æ“ä½œéƒ½ä¼šè¢«æ‹’ç»ï¼Œä½†æ˜¯è¯»æ“ä½œæ˜¯è¢«å…è®¸çš„</p>
<blockquote>
<p>åœ¨ä¸‰å°æœºå™¨ä¸Šåˆ›å»ºç›®å½•</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /var/<span class="built_in">log</span>/elasticsearch</span><br><span class="line">mkdir -p /var/data/elasticsearch</span><br><span class="line">mkdir -p /var/plugin/elasticsearch</span><br><span class="line">mkdir -p /etc/elasticsearch</span><br><span class="line"></span><br><span class="line">chown -R elasticsearch /usr/<span class="built_in">local</span>/elasticsearch</span><br><span class="line">chown -R elasticsearch /var/<span class="built_in">log</span>/elasticsearch</span><br><span class="line">chown -R elasticsearch /var/data/elasticsearch</span><br><span class="line">chown -R elasticsearch /var/plugin/elasticsearch</span><br><span class="line">chown -R elasticsearch /etc/elasticsearch</span><br><span class="line">chown -R elasticsearch /usr/<span class="built_in">local</span>/tmp</span><br></pre></td></tr></table></figure>
<blockquote>
<p>ä¿®æ”¹é…ç½®æ–‡ä»¶</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@elasticsearch01 ~]<span class="comment"># cp /usr/local/elasticsearch/config/elasticsearch.yml  /etc/elasticsearch/</span></span><br><span class="line">[root@elasticsearch01 ~]<span class="comment"># cp /usr/local/elasticsearch/config/log4j2.properties /etc/elasticsearch/</span></span><br><span class="line">[root@elasticsearch01 ~]<span class="comment"># cp /usr/local/elasticsearch/config/jvm.options /etc/elasticsearch/</span></span><br><span class="line">[root@elasticsearch01 ~]<span class="comment"># cd /etc/elasticsearch/</span></span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">[root@elasticsearch01 elasticsearch]<span class="comment"># vi elasticsearch.yml</span></span><br><span class="line"><span class="comment"># ä¸å…¶ä»–æœºå™¨ç»„æˆçš„é›†ç¾¤åç§°</span></span><br><span class="line">cluster.name: cluster-elasticsearch-prod</span><br><span class="line"><span class="comment"># èŠ‚ç‚¹åç§°</span></span><br><span class="line">node.name: node-elasticsearch-01</span><br><span class="line"><span class="comment"># bootstrap.memory_lock: false</span></span><br><span class="line"><span class="comment"># ç»‘å®šåˆ°éå›ç¯ipåœ°å€ï¼Œå¯ä»¥ä¸å…¶ä»–æœºå™¨è¿›è¡Œé€šä¿¡</span></span><br><span class="line">network.host: 192.168.31.180</span><br><span class="line">discovery.zen.ping.unicast.hosts: [<span class="string">"elasticsearch01"</span>, <span class="string">"elasticsearch02"</span>,<span class="string">"elasticsearch03"</span>]</span><br><span class="line">discovery.zen.ping_timeout: 60s</span><br><span class="line">discovery.zen.join_timeout: 60s</span><br><span class="line">discovery.zen.master_election.ignore_non_master_pings: <span class="literal">true</span></span><br><span class="line"><span class="comment"># é¢„é˜²é›†ç¾¤è„‘è£‚</span></span><br><span class="line">discovery.zen.minimum_master_nodes: 3</span><br><span class="line"><span class="comment"># è®¾ç½®æ•°æ®æ–‡ä»¶ç›®å½•</span></span><br><span class="line">path.data: /var/data/elasticsearch</span><br><span class="line"><span class="comment"># è®¾ç½®æ—¥å¿—æ–‡ä»¶ç›®å½•ï¼Œå¯ä»¥æŒ‡å®šå¤šä¸ªç›®å½•ï¼Œç”¨é€—å·åˆ†éš”å³å¯</span></span><br><span class="line">path.logs: /var/<span class="built_in">log</span>/elasticsearch</span><br><span class="line"><span class="comment"># è®¾ç½®æ’ä»¶å­˜æ”¾ç›®å½•</span></span><br><span class="line"><span class="comment"># path.plugins: /var/plugin/elasticsearch</span></span><br><span class="line"><span class="comment"># path.conf: /etc/elasticsearch</span></span><br><span class="line"><span class="comment"># è®¾ç½®é¢„é˜²è„‘è£‚ï¼Œé¢„é˜²ä¸€ä¸ªé›†ç¾¤ä¸­å­˜åœ¨ä¸¤ä¸ªmaster</span></span><br><span class="line">discovery.zen.minimum_master_nodes: 2</span><br><span class="line"><span class="comment"># esç›´åˆ°æœ‰è¶³å¤Ÿçš„nodeéƒ½ä¸Šçº¿ä¹‹åï¼Œå†å¼€å§‹shard recoveryçš„è¿‡ç¨‹</span></span><br><span class="line">gateway.recover_after_nodes: 2</span><br><span class="line"><span class="comment"># è®¾ç½®ä¸€ä¸ªé›†ç¾¤ä¸­è‡³å°‘æœ‰å¤šå°‘ä¸ªnode</span></span><br><span class="line">gateway.expected_nodes: 3</span><br><span class="line"><span class="comment"># è®¾ç½®ç­‰å¾…nodeçš„æ—¶é—´</span></span><br><span class="line">gateway.recover_after_time: 5m</span><br></pre></td></tr></table></figure>
<blockquote>
<p>æ—¥å¿—é…ç½®è¯¦è§£</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é…ç½®äº†appenderç±»å‹RollingFile</span></span><br><span class="line">appender.rolling.type = RollingFile</span><br><span class="line">appender.rolling.name = rolling</span><br><span class="line"><span class="comment"># é…ç½®æ—¥å¿—è·¯å¾„</span></span><br><span class="line">appender.rolling.fileName = <span class="variable">$&#123;sys:es.logs.base_path&#125;</span><span class="variable">$&#123;sys:file.separator&#125;</span><span class="variable">$&#123;sys:es.logs.cluster_name&#125;</span>.<span class="built_in">log</span></span><br><span class="line"><span class="comment"># é…ç½®åŸºäºæ—¶é—´çš„rollç­–ç•¥</span></span><br><span class="line">appender.rolling.layout.type = PatternLayout</span><br><span class="line">appender.rolling.layout.pattern = [%d&#123;ISO8601&#125;][%-5p][%-25c] %.10000m%n</span><br><span class="line"><span class="comment"># é…ç½®å°†æ—¥å¿—æ¯å¤©å†™ä¸€ä»½åˆ°/var/log/elasticsearch/production-2017-01-01.logæ–‡ä»¶ä¸­</span></span><br><span class="line">appender.rolling.filePattern = <span class="variable">$&#123;sys:es.logs.base_path&#125;</span><span class="variable">$&#123;sys:file.separator&#125;</span><span class="variable">$&#123;sys:es.logs.cluster_name&#125;</span>-%d&#123;yyyy-MM-dd&#125;.<span class="built_in">log</span></span><br><span class="line">appender.rolling.policies.type = Policies</span><br><span class="line"><span class="comment"># é…ç½®åŸºäºæ—¶é—´çš„rollç­–ç•¥</span></span><br><span class="line">appender.rolling.policies.time.type = TimeBasedTriggeringPolicy</span><br><span class="line"><span class="comment"># è®¾ç½®æ¯å¤©ä¸€ä»½æ—¥å¿—æ–‡ä»¶</span></span><br><span class="line">appender.rolling.policies.time.interval = 1</span><br><span class="line"><span class="comment"># è®¾ç½®æ ¹æ®è‡ªç„¶å¤©æ¥åˆ’åˆ†æ–‡ä»¶ï¼Œè€Œä¸æ˜¯24å°æ—¶</span></span><br><span class="line">appender.rolling.policies.time.modulate = <span class="literal">true</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>æ—¥å¿—é…ç½®</p>
</blockquote>
<p>esä½¿ç”¨log4j2æ¥è®°å½•æ—¥å¿—ï¼Œlog4j2å¯ä»¥é€šè¿‡log4j2.propertiesæ–‡ä»¶æ¥è¿›è¡Œé…ç½®</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">appender.rolling.strategy.type = DefaultRolloverStrategy </span><br><span class="line">appender.rolling.strategy.action.type = Delete </span><br><span class="line">appender.rolling.strategy.action.basepath = <span class="variable">$&#123;sys:es.logs.base_path&#125;</span> </span><br><span class="line">appender.rolling.strategy.action.condition.type = IfLastModified </span><br><span class="line">appender.rolling.strategy.action.condition.age = 7D </span><br><span class="line">appender.rolling.strategy.action.PathConditions.type = IfFileName </span><br><span class="line">appender.rolling.strategy.action.PathConditions.glob = <span class="variable">$&#123;sys:es.logs.cluster_name&#125;</span>-*</span><br></pre></td></tr></table></figure>
<h3 id="ç¦æ­¢swapping"><a href="#ç¦æ­¢swapping" class="headerlink" title="ç¦æ­¢swapping"></a>ç¦æ­¢swapping</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@elasticsearch01 ~]<span class="comment"># vi /etc/fstab</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># /etc/fstab</span></span><br><span class="line"><span class="comment"># Created by anaconda on Mon Jul 17 23:05:14 2017</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Accessible filesystems, by reference, are maintained under '/dev/disk'</span></span><br><span class="line"><span class="comment"># See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) for more info</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">/dev/mapper/cl-root     /                       xfs     defaults        0 0</span><br><span class="line">UUID=bf320a34-67d2-4125-ba31-e3a76bac0480 /boot                   xfs     defaults        0 0</span><br><span class="line"><span class="comment"># /dev/mapper/cl-swap     swap                    swap    defaults        0 0</span></span><br></pre></td></tr></table></figure>
<h3 id="æŒ‡å®šä¸€ä¸ªæ–°çš„ä¸´æ—¶ç›®å½•"><a href="#æŒ‡å®šä¸€ä¸ªæ–°çš„ä¸´æ—¶ç›®å½•" class="headerlink" title="æŒ‡å®šä¸€ä¸ªæ–°çš„ä¸´æ—¶ç›®å½•"></a>æŒ‡å®šä¸€ä¸ªæ–°çš„ä¸´æ—¶ç›®å½•</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@elasticsearch01 ~]<span class="comment"># mkdir -p /usr/local/tmp</span></span><br><span class="line">[root@elasticsearch01 ~]<span class="comment"># cd /etc/elasticsearch/</span></span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@elasticsearch01 elasticsearch]<span class="comment"># vi jvm.options</span></span><br><span class="line">-Djava.io.tmpdir=/usr/<span class="built_in">local</span>/tmp</span><br></pre></td></tr></table></figure>
<h3 id="è™šæ‹Ÿå†…å­˜è®¾ç½®"><a href="#è™šæ‹Ÿå†…å­˜è®¾ç½®" class="headerlink" title="è™šæ‹Ÿå†…å­˜è®¾ç½®"></a>è™šæ‹Ÿå†…å­˜è®¾ç½®</h3><p>esä½¿ç”¨hybrid mmapfs / niofsç›®å½•æ¥å­˜å‚¨indexæ•°æ®ï¼Œæ“ä½œç³»ç»Ÿçš„é»˜è®¤mmap counté™åˆ¶æ˜¯å¾ˆä½çš„ï¼Œå¯èƒ½ä¼šå¯¼è‡´å†…å­˜è€—å°½çš„å¼‚å¸¸ã€‚</p>
<p>éœ€è¦æå‡mmap countçš„é™åˆ¶ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sysctl -w vm.max_map_count=262144</span><br></pre></td></tr></table></figure>
<p>å¦‚æœè¦æ°¸ä¹…æ€§è®¾ç½®è¿™ä¸ªå€¼ï¼Œè¦ä¿®æ”¹/etc/sysctl.confï¼Œå°†vm.max_map_countçš„å€¼ä¿®æ”¹ä¸€ä¸‹ï¼Œé‡å¯è¿‡åï¼Œç”¨sysctl vm.max_map_countæ¥éªŒè¯ä¸€ä¸‹æ•°å€¼æ˜¯å¦ä¿®æ”¹æˆåŠŸ</p>
<p>esåŒæ—¶ä¼šç”¨NioFSå’ŒMMapFSæ¥å¤„ç†ä¸åŒçš„æ–‡ä»¶ï¼Œæˆ‘ä»¬éœ€è¦è®¾ç½®æœ€å¤§çš„mapåˆ·å¦ï¼Œè¿™æ ·æˆ‘ä»¬æ‰èƒ½æœ‰è¶³å¤Ÿçš„è™šæ‹Ÿå†…å­˜æ¥ç»™mmappedæ–‡ä»¶ä½¿ç”¨ï¼Œå¯ä»¥ç”¨sysctlæ¥è®¾ç½®ï¼šsysctl -w vm.max_map_count=262144ã€‚è¿˜å¯ä»¥å†/etc/sysctl.confä¸­ï¼Œå¯¹vm.max_map_countæ¥è®¾ç½®</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@elasticsearch01 ~]<span class="comment"># sysctl -w vm.max_map_count=262144</span></span><br><span class="line">vm.max_map_count = 262144</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@elasticsearch01 ~]<span class="comment"># vi /etc/sysctl.conf</span></span><br><span class="line">vm.max_map_count=262144</span><br><span class="line"><span class="comment"># é…ç½®swappiness</span></span><br><span class="line">vm.swappiness=1</span><br></pre></td></tr></table></figure>
<h3 id="è®¾ç½®çº¿ç¨‹çš„æ•°é‡ï¼Œè®¾ç½®esç”¨æˆ·èƒ½åˆ›å»ºçš„æœ€å¤§çº¿ç¨‹æ•°é‡è‡³å°‘åœ¨2048"><a href="#è®¾ç½®çº¿ç¨‹çš„æ•°é‡ï¼Œè®¾ç½®esç”¨æˆ·èƒ½åˆ›å»ºçš„æœ€å¤§çº¿ç¨‹æ•°é‡è‡³å°‘åœ¨2048" class="headerlink" title="è®¾ç½®çº¿ç¨‹çš„æ•°é‡ï¼Œè®¾ç½®esç”¨æˆ·èƒ½åˆ›å»ºçš„æœ€å¤§çº¿ç¨‹æ•°é‡è‡³å°‘åœ¨2048"></a>è®¾ç½®çº¿ç¨‹çš„æ•°é‡ï¼Œè®¾ç½®esç”¨æˆ·èƒ½åˆ›å»ºçš„æœ€å¤§çº¿ç¨‹æ•°é‡è‡³å°‘åœ¨2048</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">esç”¨äº†å¾ˆå¤šçº¿ç¨‹æ± æ¥åº”å¯¹ä¸åŒç±»å‹çš„æ“ä½œ</span><br><span class="line">åœ¨éœ€è¦çš„æ—¶å€™åˆ›å»ºæ–°çš„çº¿ç¨‹æ˜¯å¾ˆé‡è¦çš„</span><br><span class="line">è¦ç¡®ä¿esç”¨æˆ·èƒ½åˆ›å»ºçš„æœ€å¤§çº¿ç¨‹æ•°é‡è‡³å°‘åœ¨2048ä»¥ä¸Šã€‚</span><br><span class="line"></span><br><span class="line">å¯ä»¥é€šè¿‡<span class="built_in">ulimit</span> -u 2048æ¥ä¸´æ—¶è®¾ç½®</span><br><span class="line">ä¹Ÿå¯ä»¥åœ¨/etc/security/limits.confä¸­</span><br><span class="line">è®¾ç½®nprocä¸º2048æ¥æ°¸ä¹…æ€§è®¾ç½®ã€‚</span><br></pre></td></tr></table></figure>
<h3 id="é…ç½®-etc-security-limits-confæ–‡ä»¶"><a href="#é…ç½®-etc-security-limits-confæ–‡ä»¶" class="headerlink" title="é…ç½®/etc/security/limits.confæ–‡ä»¶"></a>é…ç½®/etc/security/limits.confæ–‡ä»¶</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@elasticsearch01 ~]<span class="comment"># vi /etc/security/limits.conf</span></span><br><span class="line"><span class="comment"># å¯åŠ¨esè¿›ç¨‹çš„ç”¨æˆ·æ²¡æœ‰æƒé™å»lock memoryï¼Œéœ€è¦é€šè¿‡ä»¥ä¸‹æ–¹å¼è¿›è¡Œæˆæƒ</span></span><br><span class="line">elasticsearch hard memlock unlimited</span><br><span class="line">elasticsearch soft memlock unlimited</span><br><span class="line"><span class="comment"># è®¾ç½®çº¿ç¨‹çš„æ•°é‡ï¼Œè®¾ç½®esç”¨æˆ·èƒ½åˆ›å»ºçš„æœ€å¤§çº¿ç¨‹æ•°é‡è‡³å°‘åœ¨2048</span></span><br><span class="line">elasticsearch hard nproc 2048</span><br><span class="line">elasticsearch hard nofile 65536</span><br><span class="line">elasticsearch hard as unlimited</span><br></pre></td></tr></table></figure>
<h2 id="å°†ESé…ç½®æ–‡ä»¶å‘é€åˆ°å¦å¤–ä¸‰å°æœºå™¨ä¸Š"><a href="#å°†ESé…ç½®æ–‡ä»¶å‘é€åˆ°å¦å¤–ä¸‰å°æœºå™¨ä¸Š" class="headerlink" title="å°†ESé…ç½®æ–‡ä»¶å‘é€åˆ°å¦å¤–ä¸‰å°æœºå™¨ä¸Š"></a>å°†ESé…ç½®æ–‡ä»¶å‘é€åˆ°å¦å¤–ä¸‰å°æœºå™¨ä¸Š</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@elasticsearch01 ~]<span class="comment"># scp -r /usr/local/elasticsearch/ root@elasticsearch02:/usr/local/elasticsearch/</span></span><br><span class="line">[root@elasticsearch01 ~]<span class="comment"># scp -r /usr/local/elasticsearch/ root@elasticsearch03:/usr/local/elasticsearch/</span></span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@elasticsearch01 ~]<span class="comment"># scp -r /etc/security/limits.conf root@elasticsearch02:/etc/security/limits.conf</span></span><br><span class="line">[root@elasticsearch01 ~]<span class="comment"># scp -r /etc/security/limits.conf root@elasticsearch03:/etc/security/limits.conf</span></span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@elasticsearch01 ~]<span class="comment"># scp -r /etc/elasticsearch/ root@elasticsearch02:/etc/</span></span><br><span class="line">[root@elasticsearch01 ~]<span class="comment"># scp -r /etc/elasticsearch/ root@elasticsearch03:/etc/</span></span><br></pre></td></tr></table></figure>
<h3 id="ä¿®æ”¹å…¶ä½™æœºå™¨ä¸ŠESé…ç½®æ–‡ä»¶ä¸­çš„èŠ‚ç‚¹åç§°ã€éå›ç¯åœ°å€"><a href="#ä¿®æ”¹å…¶ä½™æœºå™¨ä¸ŠESé…ç½®æ–‡ä»¶ä¸­çš„èŠ‚ç‚¹åç§°ã€éå›ç¯åœ°å€" class="headerlink" title="ä¿®æ”¹å…¶ä½™æœºå™¨ä¸ŠESé…ç½®æ–‡ä»¶ä¸­çš„èŠ‚ç‚¹åç§°ã€éå›ç¯åœ°å€"></a>ä¿®æ”¹å…¶ä½™æœºå™¨ä¸ŠESé…ç½®æ–‡ä»¶ä¸­çš„èŠ‚ç‚¹åç§°ã€éå›ç¯åœ°å€</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@elasticsearch02 ~]<span class="comment"># cd /etc/elasticsearch/</span></span><br><span class="line">[root@elasticsearch02 config]<span class="comment"># vi elasticsearch.yml</span></span><br><span class="line"><span class="comment"># èŠ‚ç‚¹åç§°</span></span><br><span class="line">node.name: node-elasticsearch-02</span><br><span class="line"><span class="comment"># é…ç½®ä¸»æœºä¸Šçš„éå›ç¯åœ°å€</span></span><br><span class="line">network.host: 192.168.31.181</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@elasticsearch03 ~]<span class="comment"># cd /etc/elasticsearch/</span></span><br><span class="line">[root@elasticsearch03 config]<span class="comment"># vi elasticsearch.yml</span></span><br><span class="line"><span class="comment"># èŠ‚ç‚¹åç§°</span></span><br><span class="line">node.name: node-elasticsearch-03</span><br><span class="line"><span class="comment"># é…ç½®ä¸»æœºä¸Šçš„éå›ç¯åœ°å€</span></span><br><span class="line">network.host: 192.168.31.182</span><br></pre></td></tr></table></figure>
<h3 id="è®¾ç½®ESç¯å¢ƒå˜é‡"><a href="#è®¾ç½®ESç¯å¢ƒå˜é‡" class="headerlink" title="è®¾ç½®ESç¯å¢ƒå˜é‡"></a>è®¾ç½®ESç¯å¢ƒå˜é‡</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@elasticsearch01 ~]<span class="comment"># vi .bashrc</span></span><br><span class="line"><span class="built_in">export</span> ES_HOME=/usr/<span class="built_in">local</span>/elasticsearch/</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$ES_HOME</span>/bin</span><br><span class="line">[root@elasticsearch01 ~]<span class="comment"># source .bashrc</span></span><br></pre></td></tr></table></figure>
<h3 id="åˆ‡æ¢åˆ°elasticsearchç”¨æˆ·æ¥å¯åŠ¨esè¿›ç¨‹"><a href="#åˆ‡æ¢åˆ°elasticsearchç”¨æˆ·æ¥å¯åŠ¨esè¿›ç¨‹" class="headerlink" title="åˆ‡æ¢åˆ°elasticsearchç”¨æˆ·æ¥å¯åŠ¨esè¿›ç¨‹"></a>åˆ‡æ¢åˆ°elasticsearchç”¨æˆ·æ¥å¯åŠ¨esè¿›ç¨‹</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">su elasticsearch</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/elasticsearch/bin</span><br><span class="line">elasticsearch -d -Epath.conf=/etc/elasticsearch</span><br></pre></td></tr></table></figure>
<p>æˆ–è€…</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[elasticsearch@elasticsearch01 ~]$ elasticsearch -d -Epath.conf=/etc/elasticsearch</span><br><span class="line">[elasticsearch@elasticsearch02 ~]$ elasticsearch -d -Epath.conf=/etc/elasticsearch</span><br><span class="line">[elasticsearch@elasticsearch03 ~]$ elasticsearch -d -Epath.conf=/etc/elasticsearch</span><br></pre></td></tr></table></figure>
<h3 id="æŸ¥çœ‹elasticsearchæ—¥å¿—"><a href="#æŸ¥çœ‹elasticsearchæ—¥å¿—" class="headerlink" title="æŸ¥çœ‹elasticsearchæ—¥å¿—"></a>æŸ¥çœ‹elasticsearchæ—¥å¿—</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[elasticsearch@elasticsearch01 ~]$ ll /var/<span class="built_in">log</span>/elasticsearch/</span><br><span class="line">æ€»ç”¨é‡ 32</span><br><span class="line">-rw-rw-r--. 1 elasticsearch elasticsearch     0 10æœˆ 15 23:10 cluster-elasticsearch-prod_deprecation.log</span><br><span class="line">-rw-rw-r--. 1 elasticsearch elasticsearch     0 10æœˆ 15 23:10 cluster-elasticsearch-prod_index_indexing_slowlog.log</span><br><span class="line">-rw-rw-r--. 1 elasticsearch elasticsearch     0 10æœˆ 15 23:10 cluster-elasticsearch-prod_index_search_slowlog.log</span><br><span class="line">-rw-rw-r--. 1 elasticsearch elasticsearch 31979 10æœˆ 15 23:42 cluster-elasticsearch-prod.log</span><br></pre></td></tr></table></figure>
<h3 id="æŸ¥çœ‹ESé›†ç¾¤æ˜¯å¦å¯åŠ¨æˆåŠŸ"><a href="#æŸ¥çœ‹ESé›†ç¾¤æ˜¯å¦å¯åŠ¨æˆåŠŸ" class="headerlink" title="æŸ¥çœ‹ESé›†ç¾¤æ˜¯å¦å¯åŠ¨æˆåŠŸ"></a>æŸ¥çœ‹ESé›†ç¾¤æ˜¯å¦å¯åŠ¨æˆåŠŸ</h3><blockquote>
<p>åœ¨æµè§ˆå™¨åœ°å€æ è®¿é—®ï¼š<a href="http://192.168.31.180:9200/" target="_blank" rel="noopener">http://192.168.31.180:9200/</a></p>
</blockquote>
<p><img src="http://ww1.sinaimg.cn/large/dc05ba18gy1fkjf0hsw9oj21a60godjo.jpg" alt="All text"></p>
<blockquote>
<p>åœ¨æµè§ˆå™¨åœ°å€æ è®¿é—®ï¼š<a href="http://192.168.31.181:9200/" target="_blank" rel="noopener">http://192.168.31.181:9200/</a></p>
</blockquote>
<p><img src="http://ww1.sinaimg.cn/large/dc05ba18gy1fkjf0ie8zmj21740g8429.jpg" alt="All text"></p>
<blockquote>
<p>åœ¨æµè§ˆå™¨åœ°å€æ è®¿é—®ï¼š<a href="http://192.168.31.182:9200/" target="_blank" rel="noopener">http://192.168.31.182:9200/</a></p>
</blockquote>
<p><img src="http://ww1.sinaimg.cn/large/dc05ba18gy1fkjf0i3rucj216i0gcn0y.jpg" alt="All text"></p>
<h2 id="è®¿é—®es"><a href="#è®¿é—®es" class="headerlink" title="è®¿é—®es"></a>è®¿é—®es</h2><p>ä¸€èˆ¬å»ºè®®åœ¨ç®¡ç†æœºä¸Šå®‰è£…ä¸€ä¸ªcurlå·¥å…·ï¼Œå¯ä»¥æ‰‹å·¥å‘é€rest apiè¯·æ±‚</p>
<p>å¯ä»¥å¯¹å¯åŠ¨äº†esçš„èŠ‚ç‚¹çš„9200ç«¯å£ï¼Œå‘é€ä¸€ä¸ªGET /è¯·æ±‚ï¼Œå¯ä»¥çœ‹çœ‹esæ˜¯å¦å¯åŠ¨æˆåŠŸ</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -XGET elasticsearch03:9200</span><br></pre></td></tr></table></figure>
<p><img src="http://ww1.sinaimg.cn/large/dc05ba18gy1fkjfh28ytsj21ku0jm474.jpg" alt="All text"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -XGET elasticsearch01:9200/_cat/nodes?v</span><br></pre></td></tr></table></figure>
<p><img src="http://ww1.sinaimg.cn/large/dc05ba18gy1fkm38wdmkgj21vu078wkn.jpg" alt="All text"></p>
<h2 id="åœæ­¢es"><a href="#åœæ­¢es" class="headerlink" title="åœæ­¢es"></a>åœæ­¢es</h2><p>ä¼˜é›…çš„å…³é—­esï¼Œå¯ä»¥ç¡®ä¿eså…³é—­çš„å¾ˆå¹²å‡€ï¼Œå¹¶ä¸”ä¼˜é›…å…³é—­èµ„æºã€‚<br>ä¸¾ä¾‹æ¥è¯´ï¼Œå¦‚æœnodeåœ¨ä¸€ä¸ªåˆç†çš„é¡ºåºä¸‹å…³é—­äº†ï¼Œé¦–å…ˆä¼šå°†è‡ªå·±ä»clusterä¸­ä¼˜é›…ç§»é™¤ï¼Œfsync translogæ—¥å¿—åˆ°ç£ç›˜ä¸­å»ï¼Œç„¶åæ‰§è¡Œå…¶ä»–ç›¸å…³çš„cleanupæ´»åŠ¨ã€‚</p>
<p>å¦‚æœæˆ‘ä»¬å°†esç”¨serviceçš„æ–¹å¼æ¥è¿è¡Œï¼Œé‚£ä¹ˆå¯ä»¥é€šè¿‡serverç®¡ç†åŠŸèƒ½æ¥åœæ­¢esã€‚</p>
<p>å¦‚æœæˆ‘ä»¬æ˜¯ç›´æ¥å¯åŠ¨esçš„ï¼Œå¯ä»¥control-Cåœæ­¢esï¼Œæˆ–è€…æ˜¯å‘é€SEGTERMä¿¡å·ç»™esè¿›ç¨‹</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[elasticsearch@elasticsearch01 elasticsearch]$ jps | grep Elasticsearch</span><br><span class="line">3661 Elasticsearch</span><br><span class="line">[elasticsearch@elasticsearch01 elasticsearch]$ <span class="built_in">kill</span> -SIGTERM 3661</span><br></pre></td></tr></table></figure>
<p><img src="http://ww1.sinaimg.cn/large/dc05ba18gy1fkm3ubf4roj21ag05madh.jpg" alt="All text"></p>
<p>å¦‚æœeså‘ç”Ÿäº†fatal errorï¼Œç±»ä¼¼out of memory errorï¼Œä»£ç bugï¼Œæˆ–è€…io errorï¼Œç­‰ç­‰</p>
<p>å½“eså‘ç°jvmæœ‰ä¸€ä¸ªfatal errorï¼Œå°±ä¼šå°è¯•è®°å½•åœ¨logé‡Œé¢ï¼Œç„¶åå°è¯•å»åœæ­¢jvmã€‚æ­¤æ—¶esæ˜¯ä¸ä¼šæŒ‰ç…§ä¼˜é›…å…³é—­çš„æ¨¡å¼å»æ‰§è¡Œçš„ï¼Œè€Œæ˜¯ä¼šç›´æ¥å…³é—­ï¼Œå¹¶ä¸”è¿”å›ä¸€ä¸ªé”™è¯¯ç </p>
<p>JVM internal error                     128<br>Out of memory error                 127<br>Stack overflow error                 126<br>Unknown virtual machine error         125<br>Serious I/O error                     124<br>Unknown fatal error                 1</p>

    </div>
  </div>
  
    <div class="copy-right">
      <div class="markdown-body">
        <blockquote>
        
        
          æœ¬æ–‡ä½œè€… : Matrix <br>
        
        åŸæ–‡é“¾æ¥ : <a href="">http://yoursite.com/2017/07/24/ElasticSearché›†ç¾¤éƒ¨ç½²/</a><br>
        ç‰ˆæƒå£°æ˜ : æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼
        </blockquote>
      </div>
    </div>
  
  
  
    <div class="social-share" style="margin-top: -2rem" data-wechat-qrcode-title="<p>å¾®ä¿¡æ‰«ä¸€æ‰«</p>" data-wechat-qrcode-helper="<p>å¾®ä¿¡å³ä¸Šè§’, æ‰«ä¸€æ‰«åˆ†äº«</p>" data-sites="qzone, qq, weibo, wechat, douban, google, facebook, twitter">
  <span style="color: #6b7487; font-size: 1.4rem;">åˆ†äº«åˆ°: </span>
</div>
<script src="https://cdn.bootcss.com/social-share.js/1.0.16/js/social-share.min.js" async></script>
  

  
    <div id="reward">
  
    <p id="reward-meta">çŸ¥è¯† & æƒ…æ€€ | äºŒè€…å…¼å¾—</p>
  
  <button id="reward-btn">
    
    <span>æŠ•é£Ÿ</span>
  </button>
  <div id="reward-qrcode">
    
      <div class="reward-qrcode--container">
        <img class="qrcode-img" src="/images/wechatpay.jpg" alt="å¾®ä¿¡æ‰«ä¸€æ‰«, å‘æˆ‘æŠ•é£Ÿ">
        <p class="qrcode-meta">å¾®ä¿¡æ‰«ä¸€æ‰«, å‘æˆ‘æŠ•é£Ÿ</p>
      </div>
    
      <div class="reward-qrcode--container">
        <img class="qrcode-img" src="/images/alipaypay.jpg" alt="æ”¯ä»˜å®æ‰«ä¸€æ‰«, å‘æˆ‘æŠ•é£Ÿ">
        <p class="qrcode-meta">æ”¯ä»˜å®æ‰«ä¸€æ‰«, å‘æˆ‘æŠ•é£Ÿ</p>
      </div>
    
  </div>

</div>

<script>
  (() => {
    let button = document.querySelector('#reward-btn'),
      qrcode = document.querySelector('#reward-qrcode'),
      display = false;
    
    button.addEventListener('click', () => {
      qrcode.style.display = display ? 'none' : 'block'
      display = !display
    }, false)
  })()
</script>
  

  <div class="article-footer">
    <div class="article-meta pull-left">
      <span>
        
          <i class="iconfont icon-06tags"></i>æ ‡ç­¾: 
          
          <span class="span--tag">
            <a href="/tags/elasticsearch/">
              #elasticsearch
            </a>
          </span>
          
        
      </span>
    </div>
    <div class="article-meta pull-right">
    </div>
  </div>
</div>


  <aside id="sidebar">
    <p id="sidebar-header"></p>
    <ol id="sidebar-toc"></ol>
  </aside>
  <script async>setTimeout(generateToc, 10);</script>


  <nav class="post-navigation">
    
      <div class="nav-pre">
        <i class="iconfont icon-prev"></i>
        ä¸Šä¸€ç¯‡:
        <a href="/2017/07/21/Pythonç½‘ç»œç¼–ç¨‹/" target="_self">Pythonç½‘ç»œç¼–ç¨‹</a>
      </div>
    
    
      <div class="nav-next">
        ä¸‹ä¸€ç¯‡:
        <a href="/2017/07/31/ECMAScript 6å½©ç¥¨é¡¹ç›®-é¡¹ç›®æ„å»º/" target="_self">ECMAScript 6å½©ç¥¨é¡¹ç›®-é¡¹ç›®æ„å»º</a>
        <i class="iconfont icon-next"></i>
      </div>
    
  </nav>

  
    <a href="#comment" class="comment-anchor"></a>
<div class="comment-title"><i class="iconfont icon-footprint"></i> ç•™ä¸‹è¶³è¿¹ <i class="iconfont icon-footprint"></i></div>
<div id="vcomments"></div>

<script defer>
  if( true ) {
    let path = getRealPath()
    new Valine({
      el: "#vcomments",
      appId: "Hyq9wkH495DgNHWhDQCOfQSp-gzGzoHsz",
      appKey: "WaR7nrzhliHj9aVwdQzkdlGd",
      notify: false,
      verify: false,
      avatar: "robohash",
      placeholder: "æ­£ç¡®å¡«å†™é‚®ç®±, æ‰èƒ½åŠæ—¶æ”¶åˆ°å›å¤å“¦â™ª(^âˆ‡^*)",
      path
    });
  }
</script>
   

  
    <script defer>
const valineAPI = (() => {
  try {
    AV.init("Hyq9wkH495DgNHWhDQCOfQSp-gzGzoHsz", "WaR7nrzhliHj9aVwdQzkdlGd");
  } catch(error) {}
  const isExist = (identity) => {
    identity = identity || getRealPath();
    let query = new AV.Query('Timer');
    return new Promise((resolve, reject) => {
      query.equalTo("identity", identity);
      query.find().then(results => {
        resolve(results.length > 0);
      }, error => reject(error));
    })
  }

  const _get = (identity) => {
    let query = null;
    if(identity && identity instanceof Array){
      let querys = [];
      for(let i = 0; i < identity.length; ++i) {
        querys[i] = new AV.Query('Timer');
        querys[i].equalTo('identity', identity[i]);
      }
      query = AV.Query.or.apply(null ,querys);
    } else {
      identity = identity || getRealPath();
      query = new AV.Query("Timer");
      query.equalTo("identity", identity);
    }

    return new Promise((resolve, reject) => {
      query.find()
      .then(results => resolve(results))
      .catch(error => reject(error))
    })
  }

  const create = (identity) => {
    identity = identity || getRealPath();
    return new Promise((resolve, reject) => {
      let Todo = AV.Object.extend('Timer');
      let todo = new Todo();
      todo.set("times", 1);
      todo.set("identity", identity);
      todo.save().then(res => resolve(true), error => reject(error));
    })
  }

  const update = (identity) => {
    identity = identity || getRealPath();
    return new Promise((resolve, reject) => {
      let query = new AV.Query('Timer');
      query.equalTo("identity", identity);
      query.find().then(todos => {
        todos.forEach(todo => {
          todo.set("times", todo.attributes.times + 1);
        });
        return AV.Object.saveAll(todos);
      }).then(todos => resolve(true), error => reject(error));
    })
  }

  return {
    isExist,
    _get,
    update,
    create
  }
})()

const calcAndWriteTimes = () => {
  let isPost = true;

  let timerAllDOM = document.querySelectorAll(".article-timer");

  if(isPost) {
    let identity = timerAllDOM[0].getAttribute("data-identity");
    valineAPI.isExist(identity)
    .then(exist => {
      if(exist) {
        return valineAPI.update(identity);
      }
      return new Promise(resolve => resolve(true));
    })
    .then( succuess => valineAPI._get(identity))
    .then( result => timerAllDOM[0].innerText = result[0].attributes.times)
    .catch(error => console.log(error.message))
    return ;
  }

  let timerDOMCache = {};

  for(let timerDOM of timerAllDOM) {
    let identity = timerDOM.getAttribute("data-identity");
    if(timerDOMCache.hasOwnProperty(identity)){
      timerDOMCache[identity].dom.push(timerDOM);
    }else{
      timerDOMCache[identity] = {
        dom: [timerDOM],
        times: undefined
      };
    }
  }

  let identities = Object.keys(timerDOMCache);
  valineAPI._get(identities).then(results => {
    for(let result of results) {
      let {identity, times} = result.attributes;
      timerDOMCache[identity].times = times;
      timerDOMCache[identity].dom.map(item => item.innerText = times);
    }
    for(let identity of identities) {
      if(timerDOMCache[identity].times){
        continue;
      }
      timerDOMCache[identity].dom.map(item => item.innerText = 1);
      valineAPI.create(identity);
    }
  }).catch(error => console.log(error.message))
}

if(true){
  calcAndWriteTimes();
}
</script>
   

</div>


      <footer>
  <p class="site-info">
    åšå®¢å·²èŒèŒå“’è¿è¡Œ<span id="time-to-now"></span><span class="my-face">(â—'â—¡'â—)ï¾‰â™¥</span>
    <br>
    Theme - <a href="https://github.com/dongyuanxin/theme-bmw">BMW</a> | Powered by <a href="https://godbmw.com/">GodBMW</a>
    <br>
    
      Copyright Â© 2019 Matrix
    
  </p>
</footer>



<script>
const timeToNowDOM = document.querySelector("#time-to-now");
const startTimestamp = new Date(2016, 4, 10).getTime();

const updateTimeStr = () => {
  let offset = parseInt(
      (new Date().getTime() - startTimestamp) / 1000,
      10
    ),
    day = Math.floor(offset / 86400),
    hour = Math.floor((offset % 86400) / 3600),
    minute = Math.floor(((offset % 86400) % 3600) / 60),
    second = Math.floor(((offset % 86400) % 3600) % 60);
  timeToNowDOM.innerHTML =
    day + "å¤©" + hour + "å°æ—¶" + minute + "åˆ†é’Ÿ" + second + "ç§’";
  setTimeout(updateTimeStr, 500);
}

setTimeout(updateTimeStr, 500);
</script>


      <div class="back-to-top hidden">
  <span>
    <i class="iconfont icon-60"></i><span></span>%
  </span>
</div>

<script>
const updateIconToTop = percent => {
  let dom = document.querySelector(".back-to-top span span");
  dom.innerText = percent;
  if(percent < 1) {
    document.querySelector(".back-to-top").className = "back-to-top hidden";
  } else {
    document.querySelector(".back-to-top").className = "back-to-top";
  }
}

const handleScoll = () => {
  let isRunning = false;
  return () => {
    if (isRunning) return;
    isRunning = true;
    window.requestAnimationFrame(timestamp => {
      let scrollTop =
          document.documentElement.scrollTop || document.body.scrollTop,
        scrollHeight =
          document.documentElement.scrollHeight ||
          document.body.scrollHeight,
        clientHeight =
          document.documentElement.clientHeight ||
          document.body.clientHeight;
      isRunning = false;
      if (scrollTop <= 1) {
        updateIconToTop(0);
        return;
      }
      if (scrollTop + clientHeight >= scrollHeight) {
        updateIconToTop(100);
      } else {
        updateIconToTop(parseInt(
          100 * scrollTop / (scrollHeight - clientHeight),
          10
        ));
      }
    });
  };
}

const backToTop = () => {
  let scrollTop =
      document.documentElement.scrollTop || document.body.scrollTop,
    delay = 10,
    time = 200;
  if (scrollTop <= 20) {
    document.documentElement.scrollTop = 0;
    document.body.scrollTop = 0;
    return;
  }
  let step = Math.ceil(scrollTop * delay / time);
  let timer = setInterval(() => {
    scrollTop =
      document.documentElement.scrollTop || document.body.scrollTop;
    if (scrollTop - step <= 0) {
      document.documentElement.scrollTop = 0;
      document.body.scrollTop = 0;
      clearInterval(timer);
    } else {
      document.documentElement.scrollTop = scrollTop - step;
      document.body.scrollTop = scrollTop - step;
    }
  }, delay);
}

document.addEventListener("scroll", handleScoll(), false);

document.querySelector(".back-to-top").addEventListener("click", backToTop, false);

</script>

    </div>

    
      <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script>
<script>
  (() => {
    const mathjaxConfig = {
      showProcessingMessages: false, //å…³é—­jsåŠ è½½è¿‡ç¨‹ä¿¡æ¯
      messageStyle: "none", //ä¸æ˜¾ç¤ºä¿¡æ¯
      jax: ["input/TeX", "output/HTML-CSS"],
      tex2jax: {
        inlineMath: [["$", "$"], ["\\(", "\\)"]], //è¡Œå†…å…¬å¼é€‰æ‹©ç¬¦
        displayMath: [["$$", "$$"], ["\\[", "\\]"]], //æ®µå†…å…¬å¼é€‰æ‹©ç¬¦
        skipTags: ["script", "noscript", "style", "textarea", "pre", "code", "a"] //é¿å¼€æŸäº›æ ‡ç­¾
      },
      "HTML-CSS": {
        availableFonts: ["STIX", "TeX"], //å¯é€‰å­—ä½“
        showMathMenu: false //å…³é—­å³å‡»èœå•æ˜¾ç¤º
      }
    }

    let mathjaxInterval = setInterval(() => {
      if(!window.MathJax){
        return;
      }
      window.MathJax.Hub.Config(mathjaxConfig)
      window.MathJax.Hub.Queue(["Typeset", MathJax.Hub, document.getElementById('app')])

      clearInterval(mathjaxInterval)
    }, 10)    
  })()
</script>
    

    <script src="https://cdn.bootcss.com/fancybox/3.5.2/jquery.fancybox.min.js" async></script>
<script async>
  let fancyTimer = setInterval(function(){
    if(!window.$){
      return;
    }
    $(document).ready(function() {
      $(".post img").each(function () {
        if($(this).parent().get(0).tagName.toLowerCase() === "a") {
          return;
        }
        // $(this).attr("data-fancybox", "gallery"); // if you add 'data-fancybox', img will display after showed
        var element = document.createElement("a");
        $(element).attr("data-fancybox", "gallery");
        $(element).attr("href", $(this).attr("src"));
        $(this).wrap(element);
      });
      
      clearInterval(fancyTimer);
    });
  }, 10);
</script>

    
  </body>

</html>
